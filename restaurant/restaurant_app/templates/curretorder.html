{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kitchen</title>
    <link rel="stylesheet" href="{% static 'plugins/bootstrap/css/bootstrap.css' %}">
<style>
        .table-tile {
            width: 100%;
            height: 500px;
            overflow: hidden;
            border: 1px solid #ddd;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }

        .table-tile .panel-body {
            overflow-y: auto; /* 设置垂直滚动条 */
            flex-grow: 1; /* 让表格主体部分可伸缩 */
        }



        .panel-heading {
            background-color: #f8f9fa;
            padding: 10px;
            font-weight: bold;
            border-bottom: 1px solid #ddd;
        }

</style>
</head>
<body>





<div class="container" style="width: 80%">
    <div class="row">
     {% if not orderlist.items %}

                       <div class="panel-heading">There are no Items ordered yet</div>
                        {% else %}

       {% for order_id, items in orderlist.items %}

            <div class="table-tile">
                <div class="panel-heading">Table No. {{ items.0.table_number }}</div>
                <div class="panel-heading">Order No. {{ order_id }}</div>
                <div class="panel-body">
                    <table class="table">
                        <thead>
                        <tr>
                            <th  style="width: 5%;">#</th>
                            <th  style="width: 15%;">Food Name</th>
                            <th style="width: 5%;">Quantity</th>
                            <th style="width: 10%;">Price</th>
                            <th style="width: 10%;">Subtotal</th>
                            <th style="width: 15%;">Status</th>
                            <th >Special Requirement</th>
                            <th style="width: 10%;">Options</th>

                        </tr>
                        </thead>
                        <tbody>


                        {% for item in items %}
                        <tr>
                            <th scope="row">{{forloop.counter}}</th>
                            {% if not item.cancled %}
                            <td>{{ item.foodname }}</td>
                            {% else %}
                            <td>{{ item.foodname }} [Canceled]</td>
                            {% endif %}
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.price }}</td>
                            {% if not item.cancled %}
                             <td>{{ item.subtotal }}</td>
                            {% else %}
                            <td><del>{{ item.subtotal }}</del></td>
                            {% endif %}

                            <td>
                                <div class="btn-group " role="group" aria-label="Basic example" style="width: 100%">

                                {% if not item.cancled %}
                                {% if item.cooking %}
                                                     {% if item.finished %}
                                <a class="btn btn-success col-md-6 dynamic-font">Finished</a>
                                {% else %}
                                <a class="btn btn-warning col-md-6" >Kooking</a>
                                {% endif %}
                                {% else %}

                                    <a class="btn btn-default col-md-6">Preparing</a>
                                {% endif %}
                                    {% else %}
                                   <a class="btn btn-danger col-md-6" >Canceled</a>
                                {% endif %}
                                </td>


                            {% if not item.cancled %}
                             {% if item.Srequest %}
                            <td>{{ item.Srequest }}<a class="btn btn-default pull-right col-md-3" href="/Srequest/{{ item.table_number }}/{{ order_id }}/{{ item.logid }} ">Edit</a></td>
                                 {% else %}
                                 <td><a class="btn btn-default col-md-6" href="/Srequest/{{ item.table_number }}/{{ order_id }}/{{ item.logid }} ">Add Special Requirement</a></td>

                            {% endif %}
                                {% else %}
                                <td>Cancelled by the kitchen because the item cannot be cooked at this time. You can continue to order other items or contact the staff.</td>
                            {% endif %}

                            <td>


                                {% if not item.cancled %}
                                {% if not item.cooking %}
                                    <a class="btn btn-default col-md-6" href="/customercancleitem/{{ item.table_number }}/{{ order_id }}/{{ item.logid }} "onclick="if(!confirm('Cancel Order?')) { event.preventDefault(); }">Cancel</a>
                                    {% else %}
                                    <a class="btn btn-danger col-md-6" onclick="if(!confirm('Can not cancel,it already on kooking!')) { event.preventDefault(); }">Cancel</a>
                                    {% endif %}
                                {% else %}
                                {% endif %}

                                    </div>
                            </td>


                        </tr>

                            {% endfor %}


                        </tbody>
                    </table>
                </div>
                    <div class="panel-footer" style="height: 60px">
                    <p class="pull-right" style="font-size:24px;font-weight: bold;padding: 10px;padding-right: 20px" id="total_price"></p>
                </div>
            </div>
        </div>

    {% endfor %}
{% endif %}






    </div>
</div>






<!-- 添加更多行 -->
<script>
  function refreshPage() {
    location.reload();
  }

  setInterval(refreshPage, 10000);
</script>
<script>
  let total = 0.00;
  {% for order_id, items in orderlist.items %}
      {% for item in items %}
           {% if not item.cancled %}
    total += {{ item.subtotal }};
          {% endif %}
          {% endfor %}

  {% endfor %}
  document.getElementById('total_price').textContent = `Total: ${total.toFixed(2)}`;
</script>
<script src="{% static 'js/jquery-3.7.1.min.js' %}"></script>
<script src="{% static 'plugins/bootstrap/js/bootstrap.js' %}"></script>
</body>
</html>